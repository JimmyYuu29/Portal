<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ portal_name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body>
    <!-- Barra de navegación superior -->
    <header class="header">
        <div class="header-content">
            <div class="logo">
                <i data-lucide="layout-grid"></i>
                <h1>{{ portal_name }}</h1>
            </div>
            <p class="tagline">{{ portal_description }}</p>
        </div>
    </header>

    <main class="main-content">
        <!-- Área de tarjetas de estadísticas -->
        <section class="stats-section">
            <h2 class="section-title">
                <i data-lucide="bar-chart-3"></i>
                Estadísticas de Visitas
            </h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i data-lucide="eye"></i>
                    </div>
                    <div class="stat-info">
                        <span class="stat-value" id="today-pv">{{ stats.today.page_views }}</span>
                        <span class="stat-label">Visitas de Hoy</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i data-lucide="users"></i>
                    </div>
                    <div class="stat-info">
                        <span class="stat-value" id="today-uv">{{ stats.today.unique_visitors }}</span>
                        <span class="stat-label">Visitantes de Hoy</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i data-lucide="trending-up"></i>
                    </div>
                    <div class="stat-info">
                        <span class="stat-value" id="total-pv">{{ stats.total.page_views }}</span>
                        <span class="stat-label">Visitas Totales</span>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon">
                        <i data-lucide="user-check"></i>
                    </div>
                    <div class="stat-info">
                        <span class="stat-value" id="total-uv">{{ stats.total.unique_visitors }}</span>
                        <span class="stat-label">Visitantes Totales</span>
                    </div>
                </div>
            </div>

            <!-- Estadísticas de aplicaciones populares -->
            {% if stats.top_apps %}
            <div class="top-apps-section">
                <h3 class="subsection-title">
                    <i data-lucide="flame"></i>
                    Herramientas Populares
                </h3>
                <div class="top-apps-list">
                    {% for app_stat in stats.top_apps[:5] %}
                    <div class="top-app-item">
                        <span class="rank">{{ loop.index }}</span>
                        <span class="app-name">{{ app_stat.app_id }}</span>
                        <span class="visit-count">{{ app_stat.total_visits }} visitas</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </section>

        <!-- Área de lista de aplicaciones -->
        <section class="apps-section">
            <h2 class="section-title">
                <i data-lucide="grid-3x3"></i>
                Lista de Herramientas
            </h2>

            {% for cat_id, category in apps_by_category.items() %}
            <div class="category-group">
                <h3 class="category-title">
                    <i data-lucide="{{ category.icon }}"></i>
                    {{ category.name }}
                </h3>
                <div class="apps-grid">
                    {% for app in category.apps %}
                    <a href="{{ url_for('go_to_app', app_id=app.id) }}" class="app-card" data-app-id="{{ app.id }}">
                        <div class="app-icon">
                            <i data-lucide="{{ app.icon | default('box') }}"></i>
                        </div>
                        <div class="app-info">
                            <h4 class="app-name">{{ app.name }}</h4>
                            {% if app.name_en %}
                            <span class="app-name-en">{{ app.name_en }}</span>
                            {% endif %}
                            <p class="app-description">{{ app.description }}</p>
                            {% if app.tags %}
                            <div class="app-tags">
                                {% for tag in app.tags[:3] %}
                                <span class="tag">{{ tag }}</span>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                        <div class="app-arrow">
                            <i data-lucide="chevron-right"></i>
                        </div>
                    </a>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}

            {% if not apps_by_category %}
            <div class="empty-state">
                <i data-lucide="inbox"></i>
                <p>No hay herramientas disponibles</p>
                <span>Por favor, contacte al administrador para añadir herramientas</span>
            </div>
            {% endif %}
        </section>
    </main>

    <!-- Pie de página -->
    <footer class="footer">
        <div class="footer-content">
            <p>
                <i data-lucide="shield-check"></i>
                Portal de Herramientas de Automatización Interna | Basado en Standard v3.1
            </p>
            <p class="footer-note">
                Equipo de Tecnología de Consultoría
            </p>
        </div>
    </footer>

    <script>
        // Inicializar iconos Lucide
        lucide.createIcons();

        // Actualizar estadísticas automáticamente (cada 60 segundos)
        setInterval(function() {
            fetch('/api/stats')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('today-pv').textContent = data.today.page_views;
                    document.getElementById('today-uv').textContent = data.today.unique_visitors;
                    document.getElementById('total-pv').textContent = data.total.page_views;
                    document.getElementById('total-uv').textContent = data.total.unique_visitors;
                })
                .catch(err => console.log('Stats update failed:', err));
        }, 60000);
    </script>
</body>
</html>
